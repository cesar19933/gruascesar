<!DOCTYPE html>
});


// Formulario -> WhatsApp
const form = document.getElementById('asistenciaForm');
form.addEventListener('submit', (e) => {
e.preventDefault();
const submitBtn = document.getElementById('enviarBtn');


// Honeypot
if (document.getElementById('empresa').value){ return; }


// Validación simple
if (!form.checkValidity()){
estado.textContent = 'Revisa los campos obligatorios.';
form.reportValidity();
return;
}


submitBtn.disabled = true;
submitBtn.textContent = 'Abriendo WhatsApp…';


const servicio = form.servicio.value;
const nombre = linea(form.nombre.value);
const telefono = linea(form.telefono.value);
const matricula = linea(form.matricula.value);
const vehiculo = linea(form.vehiculo.value);
const ubicacion = linea(form.ubicacion.value);
const detalles = linea(form.detalles.value);


// Mensaje
let msg = `Hola Grúas César, necesito *${servicio}*.%0A`;
if (ubicacion) msg += `%0A📍 Ubicación: ${encodeURIComponent(ubicacion)}%0A`;
if (gps) {
const gmaps = `https://maps.google.com/?q=${gps.lat},${gps.lng}`;
msg += `📡 GPS: ${encodeURIComponent(gmaps)} (±${gps.acc}m)%0A`;
}
if (matricula) msg += `🚘 Matrícula: ${encodeURIComponent(matricula)}%0A`;
if (vehiculo) msg += `🔎 Modelo: ${encodeURIComponent(vehiculo)}%0A`;
if (detalles) msg += `📝 Detalles: ${encodeURIComponent(detalles)}%0A`;
if (nombre) msg += `%0A👤 Nombre: ${encodeURIComponent(nombre)}`;
if (telefono) msg += `%0A📞 Tel: ${encodeURIComponent(telefono)}`;


// UTM sencillas para saber desde dónde llegó (opcional)
const utm = 'utm_source=web&utm_medium=form&utm_campaign=wa';


// Detectar si hay app instalada (solo pista básica)
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
const waUrl = `https://wa.me/${phoneE164.replace('+','')}?text=${msg}&${utm}`;
const waApp = `whatsapp://send?phone=${phoneE164}&text=${msg}`;


// Intento abrir app primero en móvil
let opened = false;
if (isMobile) {
try { window.location.href = waApp; opened = true; } catch(e) {}
}
if (!opened) {
window.open(waUrl, '_blank', 'noopener');
}


setTimeout(()=>{
submitBtn.disabled = false;
submitBtn.textContent = '💬 Enviar por WhatsApp';
}, 1500);
});
</script>
</body>
</html>
